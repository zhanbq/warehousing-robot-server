<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>货主纸箱导入工具</title>
    <script src="../../static/js/vuejs-2.5.16.js"></script>
    <script src="../../static/js/axios-0.18.0.js"></script>
    <!-- 引入样式 -->
    <link href="https://cdn.bootcss.com/element-ui/2.8.2/theme-chalk/index.css" rel="stylesheet">
    <!-- 引入组件库 -->
    <script src="https://cdn.bootcss.com/element-ui/2.8.2/index.js"></script>
</head>
<body>
<div id="app">
    <el-upload
            class="upload-demo"
            ref="upload"
            :action=host
            :on-preview="handlePreview"
            :on-remove="handleRemove"
            :file-list="fileList"
            :limit="1"
            :auto-upload="false"
            :before-upload="handleBeforeUpload"
    >
        <el-button slot="trigger" size="small" type="primary">选取货主纸箱数据导入</el-button>
        <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button>
        <div slot="tip" class="el-upload__tip">只能上传xls/xlxs文件,每次上传一个文件</div>
    </el-upload>
    <template>
        <el-table
                :data="shipperCartonList.records"
                style="width: 100%"
                :row-class-name="tableRowClassName">
            <el-table-column
                    prop="shipperName"
                    label="货主名称"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="cartonName"
                    label="纸箱名称"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="cartonLength"
                    label="长(cm)">
            </el-table-column>
            <el-table-column
                    prop="cartonWidth"
                    label="宽(cm)">
            </el-table-column>
            <el-table-column
                    prop="cartonHeight"
                    label="高(cm)">
            </el-table-column>
        </el-table>
    </template>
    <el-pagination
            @size-change="handleSizeChange"
            @current-change="handleCurrentChange"
            :current-page="currentPage"
            :page-sizes="[5, 10, 20, 40]"
            :page-size="pagesize"
            layout="total, sizes, prev, pager, next, jumper"
            :total="shipperCartonList.total">
    </el-pagination>

    <el-dialog
            title="提示"
            :visible.sync="dialogVisible"
            width="30%"
    >
        <span>{{dialogMsg}}</span>
        <span slot="footer" class="dialog-footer">
    <!--<el-button @click="dialogVisible = false">取 消</el-button>-->
    <el-button type="primary" @click="dialogVisible = false">确 定</el-button>
  </span>
    </el-dialog>

</div>
</body>
<script>
    var Main = {
        data() {
            return {
                host:"/shipper_carton/import/excel",
                fileList: [],
                dialogTableVisible: false,
                dialogShelvesSearchFormVisible: false,
                formLabelWidth: '120px',
                currentPage:1, //初始页
                pagesize:10,    //    每页的数据
                shipperCartonList:{},
                shelvesSearchForm:{},
                dialogVisible:false, //控制弹窗效果
                dialogMsg:'1',//弹窗提示信息
            }
        },
        created() {
            this.searchAll()
        },
        methods: {
            submitUpload() {
                var a = this.$refs.upload.submit();
                this.$message({type: 'success', message: '上传成功！'});
            },
            handleBeforeUpload(file) {//文件过滤，html用了accept，不过不考虑兼容下面可以不要
                var FileExt = file.name.replace(/.+\./, "");
                if (['xls', 'xlsx']
                    .indexOf(FileExt.toLowerCase()) === -1) {
                    this.$message({type: 'warning', message: '请上传后缀名为[xls,xlsx]的附件！'});
                    return false;
                }
            },
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePreview(file) {
                console.log(file);
            },
            tableRowClassName({row, rowIndex}) {
                if (rowIndex === 1) {
                    return 'warning-row';
                } else if (rowIndex === 3) {
                    return 'success-row';
                }
                return '';
            },
            // 初始页currentPage、初始每页数据数pagesize和数据data
            handleSizeChange: function (size) {
                this.pagesize = size;
                console.log(this.pagesize)  //每页下拉显示数据
                this.searchAll();
            },
            handleCurrentChange: function(currentPage){
                this.currentPage = currentPage;
                console.log(this.currentPage)  //点击第几页
                this.searchAll();
            },
            searchAll() {
                var _this = this;
                axios.get("/shipper_carton/list",{
                    params:{
                        current:this.currentPage,
                        size:this.pagesize
                    }
                }).then(function (response) {
                    _this.shipperCartonList = response.data.data;
                    // console.log('1111==='+JSON.stringify(_this.shipperCartonList));
                }).catch(function (err) {
                    console.log('err'+err);
                });
            }
        }
    }
    var Ctor = Vue.extend(Main)
    new Ctor().$mount('#app')
</script>
</html>